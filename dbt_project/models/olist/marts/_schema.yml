version: 2

models:
  - name: dim_customers
    description: dimension model for customer info
    columns:
      - name: customer_id
        description: primary key
        tests:
          - unique
          - not_null

  - name: dim_products
    description: dimension model for product info
    columns:
      - name: product_id
        description: primary key
        tests:
          - unique
          - not_null

  - name: dim_sellers
    description: dimension model for seller info
    columns:
      - name: seller_id
        description: primary key
        tests:
          - unique
          - not_null

  - name: fct_orders
    description: fact model for orders
    columns:
      - name: order_id
        description: primary key
        tests:
          - unique
          - not_null

  - name: int_customer_order_summary
    description: >
      Summary metrics for each customer, including order counts, revenue, and
      first/last order dates. Serves as a base for churn and cohort analysis.
    columns:
      - name: customer_id
        description: primary key
        tests:
          - not_null
          - unique
      - name: num_orders
        description: Number of unique orders placed by the customer
      - name: first_order_date
        description: Timestamp of the customer's first order
      - name: last_order_date
        description: Timestamp of the customer's most recent order
      - name: total_revenue
        description: Total revenue generated by this customer
      - name: avg_order_value
        description: Average value of the customer's orders

  - name: int_customer_order_cohorts
    description: >
      Adds cohort_month to the customer summary data, based on first order date
      truncated to the month level.
    columns:
      - name: customer_id
        description: primary key
        tests:
          - not_null
          - unique
      - name: cohort_month
        description: Month the customer placed their first order (for cohort analysis)
        tests:
          - not_null

  - name: int_customer_churn
    description: >
      Adds a churn flag to customers based on whether theyâ€™ve ordered in the last 60 days.
    columns:
      - name: customer_id
        description: primary key
        tests:
          - not_null
          - unique
      - name: is_churned
        description: Flag indicating churned customers (1 = churned, 0 = active)

  - name: int_customer_engagements
    description: >
      Final model joining customer summary, cohort, and churn data for reporting or dashboard use.
    columns:
      - name: customer_id
        description: primary key
        tests:
          - not_null
          - unique
      - name: num_orders
        description: Number of orders placed
      - name: total_revenue
        description: Total revenue across all orders
      - name: avg_order_value
        description: Average order value
      - name: first_order_date
        description: First order timestamp
      - name: last_order_date
        description: Most recent order timestamp
      - name: cohort_month
        description: Month of first order (for cohort grouping)
      - name: is_churned
        description: Flag for churn (1 = churned, 0 = active)
